# Task ID: 8
# Title: Implement Season Activation Logic
# Status: in-progress
# Dependencies: 5
# Priority: medium
# Description: Implement the logic responsible for transitioning a season from PENDING (waiting for players) to ACTIVE. This logic should be triggered either when the `max_players` limit is reached or when the `open_duration` timeout expires (requires Task Scheduler integration, which was found to be already implemented). Upon activation, create N games for N players in the season and trigger the initial turn OFFERs for each player via DM.
# Details:
Subtask 8.2 analysis revealed that the required integration with a task scheduler (`node-schedule`) for the `open_duration` timeout trigger was already present in the `SeasonService.ts`. The existing implementation correctly handles scheduling, timeout handling (`handleOpenDurationTimeout`), season activation (`activateSeason`), and job cleanup. No new code was required for this specific integration.

# Test Strategy:
Implement comprehensive tests including unit tests for core logic, integration tests verifying database interactions, and end-to-end tests simulating player joins and timeout scenarios. Verify season status transitions, game creation, player assignments, and initial turn offers (including Discord DMs in end-to-end tests). Ensure tests cover both `max_players` trigger and the `open_duration` timeout trigger (leveraging the existing scheduler integration).

# Subtasks:
## 8.1. undefined [completed]
### Dependencies: None
### Description: Implement the core season activation logic (check conditions, update season status, create games, assign players)
### Details:


## 8.2. undefined [completed]
### Dependencies: None
### Description: Integrate with Task Scheduler for the `open_duration` timeout trigger (Found to be already implemented in `SeasonService.ts` using `node-schedule`. Existing code handles scheduling, timeout callback, status checks, activation call, and cleanup.)
### Details:


## 8.3. undefined [completed]
### Dependencies: None
### Description: Implement the logic to send initial turn offer DMs upon activation. This involved creating `TurnService` with `offerInitialTurn` method (creating DB record, sending DM) and modifying `SeasonService.activateSeason` to iterate through games/players and call `TurnService.offerInitialTurn`. TODOs for messaging layer and timeout scheduling were noted.
### Details:


## 8.4. undefined [pending]
### Dependencies: None
### Description: Implement unit tests for the core season activation logic
### Details:


## 8.5. undefined [pending]
### Dependencies: None
### Description: Implement integration tests verifying database interactions during activation
### Details:


## 8.6. undefined [pending]
### Dependencies: None
### Description: Implement end-to-end tests covering player join and timeout scenarios, verifying full flow including Discord DMs
### Details:


