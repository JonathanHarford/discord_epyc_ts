# Task ID: 8
# Title: Implement Season Activation Logic
# Status: in-progress
# Dependencies: 5
# Priority: medium
# Description: Implement the logic responsible for transitioning a season from PENDING (waiting for players) to ACTIVE. This logic should be triggered either when the `max_players` limit is reached or when the `open_duration` timeout expires (requires Task Scheduler integration, which was found to be already implemented). Upon activation, create N games for N players in the season and trigger the initial turn OFFERs for each player via DM.
# Details:
Subtask 8.2 analysis revealed that the required integration with a task scheduler (`node-schedule`) for the `open_duration` timeout trigger was already present in the `SeasonService.ts`. The existing implementation correctly handles scheduling, timeout handling (`handleOpenDurationTimeout`), season activation (`activateSeason`), and job cleanup. No new code was required for this specific integration.

Subtask 8.4, implementing unit tests for the core season activation logic, has been completed. These tests cover activation via `max_players` and `open_duration` timeout, and rejection in invalid states or when `minPlayers` is not met. They verify the returned MessageInstruction, season status updates in the database, game creation (or lack thereof in error cases), and that turn offers are sent via the TurnService.

# Test Strategy:
Comprehensive tests are being implemented. Unit tests for the core season activation logic (completed via 8.4) cover activation via `max_players` and `open_duration` timeout, and rejection in invalid states or when `minPlayers` is not met. These tests verify MessageInstruction, season status updates, game creation, and turn offer calls. Integration tests verifying database interactions (8.5) and end-to-end tests simulating player joins and timeout scenarios (including Discord DMs via 8.6) are still pending.

# Subtasks:
## 8.1. undefined [completed]
### Dependencies: None
### Description: Implement the core season activation logic (check conditions, update season status, create games, assign players)
### Details:


## 8.2. undefined [completed]
### Dependencies: None
### Description: Integrate with Task Scheduler for the `open_duration` timeout trigger (Found to be already implemented in `SeasonService.ts` using `node-schedule`. Existing code handles scheduling, timeout callback, status checks, activation call, and cleanup.)
### Details:


## 8.3. undefined [completed]
### Dependencies: None
### Description: Implement the logic to send initial turn offer DMs upon activation. This involved creating `TurnService` with `offerInitialTurn` method (creating DB record, sending DM) and modifying `SeasonService.activateSeason` to iterate through games/players and call `TurnService.offerInitialTurn`. TODOs for messaging layer and timeout scheduling were noted.
### Details:


## 8.4. undefined [completed]
### Dependencies: None
### Description: Implement unit tests for the core season activation logic
### Details:


## 8.5. undefined [pending]
### Dependencies: None
### Description: Implement integration tests verifying database interactions during activation
### Details:


## 8.6. undefined [pending]
### Dependencies: None
### Description: Implement end-to-end tests covering player join and timeout scenarios, verifying full flow including Discord DMs
### Details:


