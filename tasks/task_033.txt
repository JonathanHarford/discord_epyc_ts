# Task ID: 33
# Title: Refactor Language Keys for joinCommand to Use Constants
# Status: pending
# Dependencies: None
# Priority: medium
# Description: To improve type safety and prevent mismatches between language keys used in code and those defined in language files, this task will establish a scalable pattern for using predefined constants for *all* command-related language strings. The initial implementation will focus on refactoring the `joinCommand` usage as an example. Additionally, a startup check will be implemented to proactively verify that all commands have corresponding language key entries defined.
# Details:
The goal is to create a central place for language key constants (e.g., `lang-keys.ts`) structured to support keys for every command. This file should use `as const` for type safety. The refactor will involve defining a clear structure within this file (e.g., a top-level `Commands` object with nested objects for each command like `JoinCommand`) and then updating the `joinCommand` related code (SeasonService, joinSeason command) to use these new constants.

Furthermore, a critical startup check must be implemented. This check will iterate through all registered commands and verify that each command has a corresponding entry (e.g., `LangKeys.Commands.YourCommandName`) defined in the `lang-keys.ts` structure. If any command is missing its language key definition, the application should fail fast during startup with a clear error message, preventing runtime errors related to missing language keys.

# Test Strategy:
Manually test the `/join season` command with various scenarios (success, already joined, season not found) to ensure messages are displayed correctly using the new constants. Verify that the structure created in `lang-keys.ts` is logical and easily extensible for other commands.

Test the new startup check:
1. Ensure the application starts successfully when all commands have corresponding entries in `LangKeys.Commands`.
2. Temporarily remove or comment out the entry for a command (e.g., `JoinCommand`) in `lang-keys.ts` and verify that the application fails to start with a clear error message indicating the missing entry.
3. Verify the check runs automatically as part of the application's initialization process.

Ensure the project compiles without TypeScript errors.

# Subtasks:
## 1. Create lang-keys.ts and Define Structure for All Command Keys [done]
### Dependencies: None
### Description: Create a new file (e.g., src/constants/lang-keys.ts). Define an exported object (e.g., LangKeys) using `as const`. Structure this object to contain nested objects or namespaces for different categories of language keys, starting with a top-level object for 'Commands'. Inside 'Commands', create a nested object for 'JoinCommand' containing all full string paths for language keys related to the join command (e.g., refs.joinCommand.join_season_success). The structure under `LangKeys.Commands` should be designed such that each command can have its own dedicated nested object.
### Details:
Ensure all keys currently used in SeasonService.ts for addPlayerToSeason and potentially in joinSeason.ts command are covered under LangKeys.Commands.JoinCommand. The structure under `LangKeys.Commands` must be suitable for the planned startup check to iterate and verify coverage for *all* commands.

## 2. Update SeasonService.ts to Use LangKeys.Commands.JoinCommand Constants [done]
### Dependencies: None
### Description: Modify src/services/SeasonService.ts. Import the LangKeys object. In the addPlayerToSeason method, replace all hardcoded string literals for language keys with references to the constants defined in LangKeys.Commands.JoinCommand.
### Details:
Example: Change return { type: 'error', key: 'refs.joinCommand.join_season_error_already_joined', ... }; to return { type: 'error', key: LangKeys.Commands.JoinCommand.ErrorAlreadyJoined, ... };

## 3. Update joinSeason.ts Command to Use LangKeys.Commands.JoinCommand (If Applicable) [done]
### Dependencies: None
### Description: Review src/commands/chat/joinSeason.ts. If it directly constructs or uses any language keys for Lang.getRef that are part of joinCommand, update these to use constants from LangKeys.Commands.JoinCommand.
### Details:
Currently, it seems to primarily use keys from SeasonService's response, so this subtask might be a quick verification. Ensure the LangKeys.Commands.JoinCommand structure is used.

## 5. Implement Language Key Coverage Check Logic [done]
### Dependencies: 33.1
### Description: Create a utility function or module responsible for verifying that every registered command has a corresponding entry within the `LangKeys.Commands` structure defined in `lang-keys.ts`. This check should compare the list of known, registered commands against the keys present directly under `LangKeys.Commands`.
### Details:
The logic should iterate through the list of commands available to the application and check if a key matching the command's identifier (or a derived identifier) exists as a property of `LangKeys.Commands`. If a command is found without a corresponding entry, the check should identify it.

## 6. Integrate Language Key Coverage Check into Application Startup [done]
### Dependencies: 33.5
### Description: Modify the application's main entry point or initialization sequence to execute the language key coverage check (implemented in Subtask 5) early in the startup process, after commands have been loaded but before the application is fully operational.
### Details:
Ensure that if the check fails (i.e., finds missing command language key entries), the application terminates immediately with a descriptive error message indicating which command(s) are missing language key definitions. This should be a critical failure.

## 4. Testing and Verification (joinCommand LangKeys Refactor & Startup Check) [pending]
### Dependencies: 33.2, 33.3, 33.6
### Description: After implementing the refactor and the startup check, perform comprehensive testing. This includes manually testing the `/join season` command with various scenarios to ensure messages are correct, verifying the structure in `lang-keys.ts` is extensible, and thoroughly testing the new startup check's behavior.
### Details:
This is a manual testing step. Test the `/join season` command (success, already joined, season not found). Verify the `LangKeys.Commands` structure is logical. Crucially, test the startup check by running the application with all entries present (should succeed) and then with a command's entry temporarily removed (should fail fast with a clear error). Ensure the project compiles without TypeScript errors.

## 7. Add placeholder LangKeys.Commands objects for all commands flagged by the coverage check [pending]
### Dependencies: None
### Description: For each command flagged as missing by the language key coverage check (Dev, Help, Info, JoinSeason, New, Test), add a corresponding empty object to LangKeys.Commands in lang-keys.ts. This ensures the coverage check passes and provides a place to add language keys as each command is refactored.
### Details:
Update src/constants/lang-keys.ts to include empty objects for Dev, Help, Info, JoinSeason, New, and Test under LangKeys.Commands. Example: LangKeys.Commands.Dev = {}. This is a preparatory step for future refactors.

