# Task ID: 60
# Title: Fix Turn Claim Timeout Warnings and Behavior
# Status: done
# Dependencies: 5, 9, 10, 14, 16, 37, 38
# Priority: high
# Description: Address issues with turn claim timeout warnings and ensure turns are correctly handled upon timeout. The root cause has been identified as missing database configuration, incomplete warning scheduling implementation in SeasonTurnService, and insufficient handling in the SchedulerService.
# Details:
Investigate the current implementation of claim timeout handling, focusing on the identified root causes:
1. Missing `claimWarning` field in the `SeasonConfig` database model.
2. Absence of claim warning scheduling logic in `SeasonTurnService`, unlike the submission warning logic in `OnDemandTurnService`.
3. The `SchedulerService.handleTurnWarningJob` only calls `OnDemandTurnService.sendTurnWarning`, not a season-specific method.

Implement the following solution plan:
1. Add the `claimWarning` field to the `SeasonConfig` model.
2. Create a database migration to add the new field.
3. Implement claim warning scheduling logic within `SeasonTurnService`, similar to how submission warnings are handled or how the claim timeout itself is scheduled.
4. Create a dedicated `sendClaimWarning` method in `SeasonTurnService` to handle sending the warning message.
5. Update `SchedulerService` to correctly handle scheduled season claim warning jobs and call the new `SeasonTurnService.sendClaimWarning` method.
6. Add necessary language strings for the claim warning messages.

Ensure the claim timeout handler correctly updates the turn state to AVAILABLE and triggers the turn offering mechanism (Task 14) to find the next eligible player upon timeout expiration. Review and potentially refactor the integration with the task scheduler (Task 38) and the claim timeout handler logic (Task 16). Consider edge cases such as server downtime or scheduler delays.

# Test Strategy:
1. Set up a test game with a short claim timeout duration and a configured `claimWarning` duration.
2. Observe the user's direct messages to verify that a timeout warning message is received at the configured time before the claim timeout.
3. Allow the claim timeout to expire without the user claiming the turn.
4. Verify that the turn state correctly transitions from OFFERED to AVAILABLE in the database.
5. Verify that the turn offering mechanism is triggered and the turn is offered to another eligible player.
6. Test with different `claimTimeout` and `claimWarning` durations configured via season settings (Task 37).
7. Test scenarios with multiple players to ensure the turn offering mechanism correctly finds the next player after a timeout.
8. Verify the content and language of the claim warning message.

# Subtasks:
## 60-1. undefined [done]
### Dependencies: None
### Description: Add 'claimWarning' field (integer, nullable) to the SeasonConfig database model.
### Details:


## 60-2. undefined [done]
### Dependencies: None
### Description: Create and run a database migration script to add the 'claimWarning' column to the season_configs table.
### Details:


## 60-3. undefined [done]
### Dependencies: None
### Description: Implement logic in SeasonTurnService to schedule a claim warning job when a turn is offered, based on the 'claimWarning' config value.
### Details:


## 60-4. undefined [done]
### Dependencies: None
### Description: Create a new method SeasonTurnService.sendClaimWarning(turnId) to fetch turn details and send the appropriate warning message to the user.
### Details:


## 60-5. undefined [done]
### Dependencies: None
### Description: Update SchedulerService.handleTurnWarningJob to differentiate between OnDemand and Season turn warnings and call the correct service method (SeasonTurnService.sendClaimWarning).
### Details:


## 60-6. undefined [done]
### Dependencies: None
### Description: Add new language strings for the claim timeout warning message.
### Details:


## 60-7. undefined [done]
### Dependencies: None
### Description: Verify that the existing claim timeout handler correctly transitions turn state to AVAILABLE and triggers the offering mechanism (Task 14) upon timeout.
### Details:


## 60-8. undefined [done]
### Dependencies: None
### Description: Write and execute tests covering claim warning scheduling, sending, and timeout behavior with various configurations.
### Details:


