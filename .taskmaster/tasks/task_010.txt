# Task ID: 10
# Title: Setup Direct Message Handling Framework
# Status: done
# Dependencies: 2
# Priority: medium
# Description: Set up the Discord.js listener to handle Direct Messages sent to the bot. Implement logic to identify the context of the DM (e.g., is the user expected to send a `/ready` command, or are they submitting a turn for a specific game/turn?). Route the DM content to the appropriate handling logic.
# Details:
Implement the core framework for receiving and routing Direct Messages. This includes setting up the Discord.js event listener for 'messageCreate' and adding initial logic to distinguish between different types of expected DM interactions.

# Test Strategy:
Implement unit tests for the core routing logic. Implement integration tests that simulate receiving a DM and routing it, using a test database but without interacting with the Discord API. Additionally, manually send various types of DMs to the bot (plain text, image, slash command) to verify the bot receives the DMs and the framework correctly identifies the sender and message type, routing it to a placeholder handler.

# Subtasks:
## 1. undefined [done]
### Dependencies: None
### Description: Implement Discord.js listener for 'messageCreate' event to capture DMs.
### Details:


## 2. undefined [done]
### Dependencies: None
### Description: Add initial logic to identify DM sender and basic message type.
### Details:


## 3. undefined [done]
### Dependencies: None
### Description: Implement placeholder routing mechanism for different DM contexts.
### Details:


## 4. undefined [done]
### Dependencies: None
### Description: Write unit tests for the DM routing logic.
### Details:


## 5. undefined [done]
### Dependencies: None
### Description: Write integration tests simulating DM reception and routing against a test database.
### Details:
<info added on 2025-05-23T20:58:36.467Z>
✅ **COMPLETED: DirectMessageHandler Integration Tests Refactored**

**What was accomplished:**
- **Refactored from unit tests with mocks to integration tests with real services**
  - Removed mocks for `TurnService`, `PlayerService`, and `SchedulerService`
  - Used real database services with the test database
  - Only kept essential mocks (Logger and MessageAdapter for avoiding language file issues)

**Following project testing guidelines:**
- ✅ **AVOID mocks** - Used real services instead of mocking them
- ✅ **Use test database** - Real database operations with proper cleanup
- ✅ **Real services** - TurnService and PlayerService use actual database
- ✅ **Mock only timing/external systems** - Only mocked SchedulerService (timers) and Discord client

**Enhanced test coverage:**
- Added integration test scenarios for `/ready` command with different player states
- Added integration test scenarios for turn submission with different player states
- Tests now verify actual database interactions and service behavior

**Test structure improvements:**
- Used `beforeAll`/`afterAll` for database setup/cleanup
- Used `beforeEach` for resetting mocks between tests
- Followed the same pattern as other integration tests in the project

**Results:**
- **All 9 DirectMessageHandler tests pass**
- **Full test suite: 444 tests passed across 27 test files**
- Tests now provide better confidence in DirectMessageHandler behavior
- Tests verify actual integration between handler and real services
- Aligns with project philosophy of testing below the chat layer with real database operations

The DirectMessageHandler tests now serve as a good example of proper integration testing in the project.
</info added on 2025-05-23T20:58:36.467Z>

## 6. undefined [done]
### Dependencies: None
### Description: Perform manual testing by sending various DMs to the bot.
### Details:


